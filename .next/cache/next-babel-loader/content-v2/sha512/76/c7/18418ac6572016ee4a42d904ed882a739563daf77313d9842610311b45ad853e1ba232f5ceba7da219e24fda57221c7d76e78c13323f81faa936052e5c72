{"ast":null,"code":"function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport fs from 'fs';\nimport getConfig from 'next/config';\nimport TelegramBot from 'node-telegram-bot-api';\nconst {\n  serverRuntimeConfig\n} = getConfig();\nexport class NotificationBot extends TelegramBot {\n  constructor(token) {\n    super(token, {\n      polling: true\n    });\n\n    _defineProperty(this, \"userIds\", void 0);\n\n    _defineProperty(this, \"sendToAll\", async message => {\n      const userIds = [...this.userIds];\n\n      for (let i = 0; i < userIds.length; i++) {\n        this.sendMessage(userIds[i], message); // eslint-disable-next-line no-await-in-loop\n\n        await new Promise(resolve => setTimeout(resolve, 35));\n      }\n    });\n\n    try {\n      this.userIds = new Set(JSON.parse(fs.readFileSync(serverRuntimeConfig.telegram.usersFile, 'utf-8')));\n    } catch {\n      this.userIds = new Set();\n    }\n\n    this.on('message', message => {\n      if (!this.userIds.has(message.chat.id)) {\n        this.userIds.add(message.chat.id);\n        fs.writeFileSync(serverRuntimeConfig.telegram.usersFile, JSON.stringify([...this.userIds]));\n      }\n    });\n  }\n\n}","map":null,"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport React, { useCallback, useEffect, useRef, useState } from 'react';\nimport { $, useEventListener } from '@utils';\nimport { Picture } from '@components';\nimport { ArrowIcon, FullScreenCloseIcon, FullScreenOpenIcon } from '@components/icons';\nimport styles from '@sass/pages/portfolio/Gallery.module.scss';\nimport { scrollTo } from './betterScroll';\nlet lastClickedIndexInLocking = null;\nlet touchStartX;\nexport const Gallery = ({\n  photos,\n  onClose\n}) => {\n  const {\n    0: mainIndex,\n    1: setMainIndex\n  } = useState(0);\n  const {\n    0: lastIndex,\n    1: setLastIndex\n  } = useState(0);\n  const {\n    0: picStyle,\n    1: setPicStyle\n  } = useState(null);\n  const {\n    0: locked,\n    1: setLocked\n  } = useState(false);\n  const {\n    0: fullScreenOpened,\n    1: setFullScreenOpened\n  } = useState(false);\n  const ref = useRef();\n  useEffect(() => {\n    document.body.style.overflow = 'hidden';\n    window.location.hash = 'gallery';\n    return () => {\n      document.body.style.overflow = null;\n    };\n  });\n  useEventListener(globalThis, 'hashchange', () => {\n    if (window.location.hash === '') onClose();\n  }, false);\n  const openFullScreen = useCallback(async () => {\n    await document.body.requestFullscreen();\n    setFullScreenOpened(true);\n  }, []);\n  const closeFullScreen = useCallback(async () => {\n    await document.exitFullscreen();\n    setFullScreenOpened(false);\n  }, []);\n\n  const chooseImage = (index, changeLastIndex = true) => {\n    if (locked) {\n      lastClickedIndexInLocking = index;\n      return;\n    }\n\n    let boundedIndex = index > 0 ? index : photos.length - 1;\n    boundedIndex = boundedIndex < photos.length ? boundedIndex : 0;\n    const el = ref.current;\n    const scrollSize = window.innerWidth > 767 ? (el.scrollHeight - el.clientHeight + 50) / photos.length : (el.scrollWidth - el.clientWidth + 40) / photos.length;\n    changeLastIndex && setLastIndex(mainIndex);\n    setMainIndex(boundedIndex);\n    setLocked(true);\n    setPicStyle({\n      left: boundedIndex < mainIndex ? '-100%' : 0\n    });\n    scrollTo(ref.current, boundedIndex * scrollSize, {\n      direction: window.innerWidth > 767 ? 'vertical' : 'horizontal'\n    });\n    setTimeout(() => {\n      setPicStyle({\n        left: boundedIndex < mainIndex ? 0 : '-100%'\n      });\n\n      const onAnimationEnd = () => {\n        setLastIndex(boundedIndex);\n        setPicStyle(null);\n        setLocked(false);\n        $(`.${styles.mainContainer} picture`).removeEventListener('transitionend', onAnimationEnd);\n\n        if (lastClickedIndexInLocking !== null) {\n          setTimeout(() => {\n            const i = lastClickedIndexInLocking;\n            lastClickedIndexInLocking = null;\n            chooseImage(i, false);\n          });\n        }\n      };\n\n      $(`.${styles.mainContainer} picture`).addEventListener('transitionend', onAnimationEnd);\n    });\n  };\n\n  const choosePrev = () => chooseImage(mainIndex - 1);\n\n  const chooseNext = () => chooseImage(mainIndex + 1);\n\n  const onTouchStart = evt => touchStartX = evt.touches[0].clientX;\n\n  const onTouchEnd = evt => {\n    const diff = evt.changedTouches[0].clientX - touchStartX;\n    touchStartX = null;\n    if (Math.abs(diff) < 20) return;\n    diff > 0 ? choosePrev() : chooseNext();\n  };\n\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: styles.gallery,\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: styles.thumbnailsContainer,\n      ref: ref,\n      children: photos.map((it, i) => /*#__PURE__*/_jsx(Picture, {\n        src: `/photos/portfolio/gallery/${it}m.jpg`,\n        onClick: () => chooseImage(i),\n        imgCls: `${styles.thumbnail} ${i === mainIndex ? styles.active : ''}`\n      }, it))\n    }), /*#__PURE__*/_jsxs(\"div\", {\n      className: styles.mainContainer,\n      onTouchStart: onTouchStart,\n      onTouchEnd: onTouchEnd,\n      children: [lastIndex > mainIndex && /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(Picture, {\n          src: `/photos/portfolio/gallery/${photos[mainIndex]}.jpg`,\n          imgCls: styles.mainPhoto,\n          style: picStyle\n        }), /*#__PURE__*/_jsx(Picture, {\n          src: `/photos/portfolio/gallery/${photos[lastIndex]}.jpg`,\n          imgCls: styles.mainPhoto,\n          style: picStyle\n        })]\n      }), lastIndex < mainIndex && /*#__PURE__*/_jsxs(_Fragment, {\n        children: [/*#__PURE__*/_jsx(Picture, {\n          src: `/photos/portfolio/gallery/${photos[lastIndex]}.jpg`,\n          imgCls: styles.mainPhoto,\n          style: picStyle\n        }), /*#__PURE__*/_jsx(Picture, {\n          src: `/photos/portfolio/gallery/${photos[mainIndex]}.jpg`,\n          imgCls: styles.mainPhoto,\n          style: picStyle\n        })]\n      }), lastIndex === mainIndex && /*#__PURE__*/_jsx(Picture, {\n        src: `/photos/portfolio/gallery/${photos[mainIndex]}.jpg`,\n        imgCls: styles.mainPhoto\n      }), /*#__PURE__*/_jsx(\"button\", {\n        className: `${styles.button} ${styles.left}`,\n        onClick: choosePrev,\n        children: /*#__PURE__*/_jsx(ArrowIcon, {\n          size: 64\n        })\n      }), /*#__PURE__*/_jsx(\"button\", {\n        className: `${styles.button} ${styles.right}`,\n        onClick: chooseNext,\n        children: /*#__PURE__*/_jsx(ArrowIcon, {\n          size: 64\n        })\n      }), fullScreenOpened ? /*#__PURE__*/_jsx(\"button\", {\n        className: `${styles.button} ${styles.fullscreen}`,\n        onClick: closeFullScreen,\n        children: /*#__PURE__*/_jsx(FullScreenCloseIcon, {\n          size: 32\n        })\n      }) : /*#__PURE__*/_jsx(\"button\", {\n        className: `${styles.button} ${styles.fullscreen}`,\n        onClick: openFullScreen,\n        children: /*#__PURE__*/_jsx(FullScreenOpenIcon, {\n          size: 32\n        })\n      })]\n    }), /*#__PURE__*/_jsx(\"button\", {\n      className: styles.close,\n      onClick: () => window.history.back(),\n      type: \"button\",\n      children: \"\\xD7\"\n    })]\n  });\n};","map":null,"metadata":{},"sourceType":"module"}